<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Java Easy Batch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mahmoud Ben Hassine">
    <meta name="author" content="Easy Batch: batch processing with java made easy">

    <!-- Bootstrap CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="../css/font-awesome.min.css" rel="stylesheet">

    <!-- Plugins -->
    <link href="../css/highlight/obsidian.css" media="screen" rel="stylesheet" />
    <link href="../css/clingify/clingify.css" rel="stylesheet">

    <!-- Theme style -->
    <link href="../css/theme-style.min.css" rel="stylesheet">

    <!--Your custom colour override-->
    <link href="../css/colour-blue.css" id="colour-scheme" rel="stylesheet">

    <!-- Your custom override -->
    <link href="../css/custom-style.css" rel="stylesheet">

    <!-- HTML5 shiv & respond.js for IE6-8 support of HTML5 elements & media queries -->
    <!--[if lt IE 9]>
    <script src="../js/plugins/html5shiv/html5shiv.js"></script>
    <script src="../js/plugins/respond/respond.min.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="../img/misc/gear.ico">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,300|Rambla|Calligraffitti' rel='stylesheet' type='text/css'>

    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-35599235-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</head>
<body class="page page-index-static">

<a href="#content" class="sr-only">Skip to content</a>
<div id="navigation" class="wrapper">
    <div class="navbar-static-top">

        <!--Header & Branding region-->
        <div class="header">
            <div class="header-inner container">
                <div class="row">
                    <div class="col-md-8">
                        <!--branding/logo-->
                        <a class="navbar-brand" href="../index.html" title="Home">
                            <h1><span>Easy</span>Batch</h1>
                        </a>
                        <div class="slogan">Batch processing with Java made easy!</div>
                    </div>

                </div>
            </div>
        </div>

        <div class="container" data-toggle="clingify">
            <div class="navbar">
                <!--
              mobile collapse menu button
              - data-toggle="toggle" = default BS menu
              - data-toggle="jpanel-menu" = jPanel Menu
              -->
                <a class="navbar-btn" data-toggle="jpanel-menu" data-target=".navbar-collapse"> <span class="bar"></span> <span class="bar"></span> <span class="bar"></span> <span class="bar"></span> </a>

                <!--user menu-->
                <div class="user-menu pull-right"> <a href="https://oss.sonatype.org/content/groups/public/org/easybatch/" data-toggle="tooltip" title="Download Easy Batch from Maven central repository" class="btn btn-primary">version : 2.2.0</a> </div>

                <!--everything within this div is collapsed on mobile-->
                <div class="navbar-collapse collapse">

                    <!--main navigation-->
                    <ul class="nav navbar-nav">
                        <li><a href="../index.html"><i class="fa fa-home fa-lg"></i> Home</a></li>
                        <li class="dropdown"> <a href="#" class="dropdown-toggle menu-item" id="features-drop" data-toggle="dropdown"><i class="fa fa-book fa-lg" ></i> Documentation +</a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="about-drop">
                                <li role="presentation"><a role="menuitem" href="../documentation/gettingStarted.html" class="menu-item"><i class="fa fa-play fa-lg"></i> Getting started</a></li>
                                <li role="presentation"><a role="menuitem" href="../documentation/architecture.html" tabindex="-1" class="menu-item"><i class="fa fa-flask fa-lg"></i> Architecture</a></li>
                                <li role="presentation"><a role="menuitem" href="../documentation/userGuide.html" tabindex="-1" class="menu-item"><i class="fa fa-book fa-lg"></i> User guide</a></li>
                                <li role="presentation"><a role="menuitem" href="../documentation/benchmarks.html" tabindex="-1" class="menu-item"><i class="fa fa-tachometer fa-lg"></i> Benchmarks</a></li>
                                <li role="presentation"><a role="menuitem" href="../documentation/faq.html" tabindex="-1" class="menu-item"><i class="fa fa-question fa-lg"></i> FAQs</a></li>
                            </ul>
                        </li>
                        <li><a href="../tutorials/index.html" class="menu-item"><i class="fa fa-code fa-lg"></i> Tutorials</a></li>
                        <li class="dropdown"> <a href="" class="dropdown-toggle" id="about-drop" data-toggle="dropdown"><i class="fa fa-thumbs-o-up fa-lg"></i> Get involved +</a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="about-drop">
                                <li role="presentation"><a role="menuitem" href="https://github.com/benas/easy-batch" target="_blank" tabindex="-1" class="menu-item"><i class="fa fa-github fa-lg"></i> Source repository</a></li>
                                <li role="presentation"><a role="menuitem" href="https://github.com/benas/easy-batch/issues" target="_blank" tabindex="-1" class="menu-item"><i class="fa fa-bug fa-lg"></i> Issue tracker</a></li>
                            </ul>
                        </li>

                    </ul>
                </div>
                <!--/.navbar-collapse -->
            </div>
        </div>
    </div>
</div>

<div id="content">
    <div class="container">

        <!-- breadcrumb -->
<ul class="breadcrumb">
    <li><a href="../index.html">Home</a></li>
    
    <li><a href="../tutorials/index.html">Tutorials</a></li>
    
    
    <li class="active">Processing data in parallel</li>
</ul>

        <div id="row">
            <div class="col-md-9">

                <h1 class="title-divider"><span>Processing data in parallel</span></h1>

                              <h2 id="1">1. Introduction</h2>

              <p>Easy Batch was designed with data processing parallelism in mind.
                  Easy Batch Engine implements the <code>java.util.concurrent.Callable</code> interface which turns it into a unit of work that can be submitted to a <code>java.util.concurrent.ExecutorService</code>.</p>
              <p>Using the <code>java.util.concurrent.ExecutorService</code> with a pool of threads allows you to run multiple Easy Batch instances in parallel.</p>
              <p>Usually, there are two main use cases for processing input data in parallel:</p>
              <ul>
                  <li>Split the data source into multiple parts which will be processed by separated threads (or JVMs)</li>
                  <li>Use a single data source and filter records to be processed by each thread</li>
              </ul>
              <p>Easy Batch does not provide a feature to partition input data but allows you to process data in parallel for both cases above.
                  So let's see how to achieve this with Easy Batch on a real use case!</p>

              <p>In this tutorial, the goal is to encrypt an input text file containing a sensible set of data. The input file named <code>secret-messages.txt</code> has the following content:</p>

<pre><code class="java">This is a secret message1!
This is a secret message2!
This is a secret message3!
This is a secret message4!
This is a secret message5!
This is a secret message6!
This is a secret message7!
This is a secret message8!
This is a secret message9!
This is a secret message10!</code></pre>

              <p>In a real use case, we suppose that this input file is a huge text file with millions of records and we would like to encrypt data in parallel.To keep the tutorial simple, we will only process 10 records.</p>
              <p>We would like to run two Easy Batch instances to process records 1-5 and records 6-10 in parallel with two methods:</p>
              <ul>
                  <li>The first one is by partitioning the input file into multiple parts.</li>
                  <li>The second one is by using a single input file with record filtering.</li>
              </ul>

              <p>To keep the tutorial simple, the encryption algorithm should simply reverse each record raw text. We will simulate a long encryption operation (1sec/record) with the following <code>RecordProcessor</code> implementation:</p>

<pre><code class="java">public class MessageEncrypter extends AbstractRecordProcessor&lt;StringRecord&gt; {

    @Override
    public void processRecord(final StringRecord record) throws Exception {
        Thread.sleep(1000);//simulating a long encryption algorithm
        System.out.println(new StringBuilder(record.getRawContent()).reverse().toString());
    }

}</code></pre>
              <p>Note that in this tutorial, we do not need to map each record to a domain object, nor validate records against any constraint.</p>

              <p>So let's get started!</p>

              <h2 id="2">2. Reading data from multiple input files</h2>

              <p>In this part, we have split the input file <code>secret-messages.txt</code> into two slices: <code>secret-messages-part1.txt</code> containing records 1-5 and <code>secret-messages-part2.txt</code> containing records 6-10:</p>

              <p class="pull-center"><img src="../img/eb/parallelMultipleParts.png"/></p>

              <p>The following listing shows how to run two Easy Batch instances to process these two parts in parallel:</p>

<pre><code class="java">// To avoid any thread-safety issues,
// we will create 2 engines with separate instances of record readers and processors

// Build an Easy Batch engine 1
EasyBatchEngine easyBatchEngine1 = new EasyBatchEngineBuilder()
        //read data from secret-messages-part1.txt
        .registerRecordReader(new FlatFileRecordReader(new File(args[0])))
        .registerRecordProcessor(new MessageEncrypter())
        .build();

// Build an Easy Batch engine 2
EasyBatchEngine easyBatchEngine2 = new EasyBatchEngineBuilder()
        //read data from secret-messages-part2.txt
        .registerRecordReader(new FlatFileRecordReader(new File(args[1])))
        .registerRecordProcessor(new MessageEncrypter())
        .build();

// Create a 2 threads pool to call Easy Batch engines in parallel
ExecutorService executorService = Executors.newFixedThreadPool(2);

Future&lt;EasyBatchReport&gt; easyBatchReport1 = executorService.submit(easyBatchEngine1);
Future&lt;EasyBatchReport&gt; easyBatchReport2 = executorService.submit(easyBatchEngine2);

executorService.shutdown();</code></pre>

              <p class="text-success">The advantage of this approach is that each Easy Batch engine reads only its own part and not the whole data source.</p>
              <p class="text-danger">The drawback of this approach is that you should split the data source into multiple parts since Easy Batch does not provide data partitioning feature and then merge results.</p>
              <p>Note that the merge operation is optional (it depends on the use case) and can be avoided if your <code>RecordProcessor</code> implementation can write data concurrently in a destination data source (a database for instance).</p>
              <p>Note also that Easy Batch engines run in the same JVM. You can also run multiple instances in separate JVMs if you want.</p>
              <p>The complete source code of this tutorial is available <a href="https://github.com/benas/easy-batch/tree/master/easybatch-tutorials/src/main/java/org/easybatch/tutorials/parallel" target="_blank">here</a>.
                  To run the tutorial with maven, launch the following command in the <code>easybatch-tutorials</code> directory :</p>

              <p><kbd><i class="fa fa-terminal"></i> mvn exec:java -PrunParallelMultipleFilesTutorial</kbd></p>

              <p>At the end of execution, you should see all the secret messages encrypted in the console.</p>

              <h2 id="3">3. Reading data from a single input file</h2>

              <p>Easy Batch does not provide a feature to partition input data, but you will see how to achieve this using the record filtering technique.</p>
              <p>In this part of the tutorial, we will configure two Easy Batch instances as follows:</p>
              <ul>
                  <li>The first engine instance will read data from the <code>secret-messages.txt</code> file and filter records which numbers are greater than 5</li>
                  <li>The second engine instance will also read data from the <code>secret-messages.txt</code> file and will filter records which numbers are lower than 6</li>
              </ul>
              <p>The figure below illustrates this configuration:</p>

              <p class="pull-center">
                  <img src="../img/eb/partitioning.png"/>
              </p>

              <p>The following listing shows the code to achieve this configuration:</p>

<pre><code class="java">// To avoid any thread-safety issues,
// we will create 2 engines with separate instances of record readers and processors

// Build an Easy Batch engine 1
EasyBatchEngine easyBatchEngine1 = new EasyBatchEngineBuilder()
        //read data from secret-messages.txt
        .registerRecordReader(new FlatFileRecordReader(new File(args[0])))
        <strong>.registerRecordFilter(new RecordNumberGreaterThanRecordFilter(5)) // filter records 6-10</strong>
        .registerRecordProcessor(new MessageEncrypter())
        .build();

// Build an Easy Batch engine 2
EasyBatchEngine easyBatchEngine2 = new EasyBatchEngineBuilder()
        //read data from secret-messages.txt
        .registerRecordReader(new FlatFileRecordReader(new File(args[0])))
        <strong>.registerRecordFilter(new RecordNumberLowerThanRecordFilter(6)) // filter records 1-5</strong>
        .registerRecordProcessor(new MessageEncrypter())
        .build();

//create a 2 threads pool to call Easy Batch engines in parallel
ExecutorService executorService = Executors.newFixedThreadPool(2);

Future&lt;EasyBatchReport&gt; easyBatchReport1 = executorService.submit(easyBatchEngine1);
Future&lt;EasyBatchReport&gt; easyBatchReport2 = executorService.submit(easyBatchEngine2);

executorService.shutdown();</code></pre>

              <p class="text-success">The advantage of this approach is that you don't need to split the input data source into multiple parts.</p>
              <p class="text-danger">The drawback of this approach is that each Easy Batch instance will read the whole data source which can be costly but remains negligible comparing to the overall speedup you can achieve with this technique.</p>
              <p>The complete source code of this tutorial is available <a href="https://github.com/benas/easy-batch/tree/master/easybatch-tutorials/src/main/java/org/easybatch/tutorials/parallel" target="_blank">here</a>.</p>

              <p>To be able to compare results and speed up, first we run a single Easy Batch instance to process the input file <code>secret-messages.txt</code> and record the total processing time (not shown in the listing above).</p>
              <p>Then, we run two Easy Batch instances that will read data from the same <code>secret-messages.txt</code> file but operate on separate parts (listing above).</p>
              <p>Finally, we will compare performance results and speed up based on the overall processing time of each method.</p>

              <p>To run the tutorial with maven, launch the following command in the <code>easybatch-tutorials</code> directory :</p>

              <p><kbd><i class="fa fa-terminal"></i> mvn exec:java -PrunParallelSingleFileTutorial</kbd></p>

              <p>At the end of execution, you should see all the secret messages encrypted in the console and the following output at the end:</p>

<pre><code>###############################################################################
Processing the input file with two Easy Batch instances in parallel took 5049ms
Processing the input file with a single Easy Batch instance took 10806ms
###############################################################################</code></pre>

              <p>As expected, running two instances of Easy Batch in parallel on separate parts of the input file is twice faster than a single instance. This 200% speed up can actually be increased to <code>x * 100%</code> if you use the same technique with x threads! :</p>

                <p class="pull-center">
                    <img src="../img/eb/parallelChart.png" style="width: 60%"/>
                </p>

              <h2 id="4">4. Conclusion</h2>
              <p>In this tutorial, we have seen how to run multiple Easy Batch instances in parallel to speed up the data processing and decrease the overall processing time.</p>
              <p>The following table summarizes the advantages and drawbacks for each approach of parallelism:</p>
              <table class="table table-bordered table-condensed ">
                  <thead>
                  <tr class="alert-info">
                      <th>Parallelism approach</th>
                      <th>Advantages</th>
                      <th>Drawbacks</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr>
                      <td>* Multiple data source parts<br/>* Multiple Easy Batch instances</td>
                      <td><span class="text-success">Each Easy Batch engine reads only its own part and not the whole data source</span></td>
                      <td><span class="text-danger">Need to split the data source into multiple parts since Easy Batch does not provide data partitioning feature</span></td>
                  </tr>
                  <tr>
                      <td>* Single data source<br/>* Multiple Easy Batch instances (with record filtering technique)</td>
                      <td><span class="text-success">No need to split the input data source into multiple parts</span></td>
                      <td><span class="text-danger">Each Easy Batch instance will read the whole data source</span></td>
                  </tr>
                  </tbody>
              </table>
              <p>Even though the tutorial was about processing an input flat file, the same technique of record filtering can be used with any type of data source.</p>



            </div>

            <div class="col-md-3 sidebar sidebar-right">
                <!-- <div class="inner" data-spy="affix" data-offset-top="40" data-offset-bottom="300"> -->
<div class="inner">
<h4>About Easy Batch</h4>
<ul class="list-lg">
    <li >
        <i class="fa fa-fw fa-angle-right"></i> <a href="../index.html">Overview</a>
    </li>
    <li >
        <i class="fa fa-fw fa-angle-right"></i> <a href="../releaseNotes.html">Release notes</a>
    </li>
</ul>
<h4>Documentation</h4>
<ul class="list-lg">
    <li >
        <i class="fa fa-fw fa-angle-right"></i> <a href="../documentation/gettingStarted.html">Getting started</a>
    </li>
    <li >
        <i class="fa fa-fw fa-angle-right"></i> <a href="../documentation/architecture.html">Architecture</a>
    </li>
    <li >
        <i class="fa fa-fw fa-angle-right"></i> <a href="../documentation/userGuide.html">User guide</a>
    </li>
    <li  class="well" >
        <i class="fa fa-fw fa-angle-right"></i> <a href="../tutorials/index.html">Tutorials</a>
    </li>
    <li >
    <i class="fa fa-fw fa-angle-right"></i> <a href="../documentation/benchmarks.html">Benchmarks</a>
    </li>
    <li >
        <i class="fa fa-fw fa-angle-right"></i> <a href="../documentation/faq.html">FAQs</a>
    </li>
</ul>
<h4>Get involved</h4>
<ul class="list-lg">
    <li><i class="fa fa-fw fa-angle-right"></i> <a href="https://github.com/benas/easy-batch" target="_blank">Source repository</a></li>
    <li><i class="fa fa-fw fa-angle-right"></i> <a href="https://github.com/benas/easy-batch/issues" target="_blank">Issue tracker</a></li>
</ul>
</div>
            </div>
        </div>


    </div>
</div>
<!-- FOOTER -->
<footer id="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-4 col">
                <div class="block contact-block">
                    <h3>Documentation</h3>
                    <ul class="fa-ul">
                        <li><a href="../documentation/gettingStarted.html"><i class="fa fa-li fa-play"></i> Getting started</a></li>
                        <li><a href="../documentation/architecture.html"><i class="fa fa-li fa-flask"></i> Architecture</a></li>
                        <li><a href="../documentation/userGuide.html"><i class="fa fa-li fa-book"></i> User guide</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-4 col">
                <div class="block contact-block">
                    <h3>Tutorials</h3>
                    <ul class="fa-ul">
                    <li><a href="../tutorials/index.html#basic"><i class="fa fa-li fa-star-o"></i> Basic tutorials</a></li>
                        <li><a href="../tutorials/index.html#intermediate"><i class="fa fa-li fa-star-half-o"></i> Intermediate tutorials</a></li>
                        <li><a href="../tutorials/index.html#advanced"><i class="fa fa-li fa-star"></i> Advanced Tutorials</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-4 col">
                <div class="block contact-block">
                    <h3>Get involved</h3>
                    <ul class="fa-ul">
                        <li><a href="https://github.com/benas/easy-batch" target="_blank"><i class="fa fa-li fa-github"></i> Source repository</a></a></li>
                        <li><a href="https://github.com/benas/easy-batch/issues" target="_blank"><i class="fa fa-li fa-bug"></i> Issue tracker</a></li>
                        <li><a href="../documentation/faq.html"><i class="fa fa-li fa-question"></i> FAQs</a></li>
                    </ul>
                </div>
            </div>

        </div>

        <p class="back-top floatright" style="display: none;">
            <a href="#top"><span></span></a>
        </p>

        <div class="row">
            <div id="toplink"><a href="#top" class="top-link" title="Back to top">Back To Top <i class="fa fa-chevron-up"></i></a></div>

            <div class="subfooter">
                <div class="col-md-6">
                    <p>&copy; Easy Batch is created by <a href="http://www.mahmoudbenhassine.com" target="_blank">Mahmoud Ben Hassine</a></p>
                </div>
                <div class="col-md-6">
                    <p class="footer-menu">Easy Batch is released under the <a href="http://opensource.org/licenses/mit-license.php/" target="_blank">MIT license</a>.</p>
                </div>
            </div>
        </div>
    </div>
</footer>

<!--Scripts -->
<script src="../js/jquery.min.js"></script>
<script src="../js/jquery-migrate-1.2.1.min.js"></script> <!--Legacy jQuery support for quicksand plugin-->

<!-- Bootstrap JS -->
<script src="../js/bootstrap.min.js"></script>

<!--JS plugins-->
<script src="../js/plugins/clingify/jquery.clingify.min.js"></script>
<script src="../js/plugins/jRespond/jRespond.js"></script>

<!--Custom scripts mainly used to trigger libraries -->
<script src="../js/script.min.js"></script>
<script src="../js/scrolltotop.js"></script>
<script src="../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>